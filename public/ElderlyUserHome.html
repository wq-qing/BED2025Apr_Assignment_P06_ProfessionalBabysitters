<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Medical App - Home</title>
  <link rel="stylesheet" href="../css/style.css" />
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Welcome to MediConnect</h1>
    </div>
    <button class="btn" id="scheduleAppointmentBtn">Schedule Appointment</button>
    <a href="/wallet">View Wallet Funds</button>
    <a href="/waitingRooms" class="btn">View Waiting Rooms</a>
    <!-- Call History Section -->
    <h2>Your Call History</h2>
    <div id="callHistory">
      <div class="empty">Loading call logs...</div>
    </div>
  <div class="bottom-nav">
    <a href="/elderlyUserHome" class="nav-button active">üè†<br>Home</a>
    <a href="/calendar" class="nav-button">üìÖ<br>Calendar</a>
    <a href="/profile" class="nav-button">üë§<br>Profile</a>
  </div>
  <script>
  async function loadCallLogs() {
    const userId = sessionStorage.getItem('userId');
    if (!userId) {
      document.getElementById('callHistory').innerHTML = '<div class="empty">User not logged in.</div>';
      return;
    }

    try {
      const res = await fetch(`/api/callLogs/${userId}`);
      const logs = await res.json();

      const container = document.getElementById('callHistory');
      if (!Array.isArray(logs) || logs.length === 0) {
        container.innerHTML = '<div class="empty">No calls yet!</div>';
        return;
      }

      container.innerHTML = ''; // clear loading text

      logs.forEach(log => {
        const div = document.createElement('div');
        div.className = 'card';

        const start = new Date(parseInt(log.StartTime)).toLocaleString();
        const end = log.EndTime ? new Date(parseInt(log.EndTime)).toLocaleString() : 'Still ongoing';
        const duration = log.Duration ? `${log.Duration} seconds` : 'Pending';

        div.innerHTML = `
          <p><strong>Room:</strong> ${log.RoomId}</p>
          <p><strong>Start:</strong> ${start}</p>
          <p><strong>End:</strong> ${end}</p>
          <p><strong>Duration:</strong> ${duration}</p>
        `;
        container.appendChild(div);
      });
    } catch (err) {
      console.error('Call log fetch failed:', err);
      document.getElementById('callHistory').innerHTML = '<div class="empty">Error loading logs.</div>';
    }
  }

  window.addEventListener('DOMContentLoaded', loadCallLogs);
</script>
  <script src="../js/app.js"></script>
</body>
</html>
